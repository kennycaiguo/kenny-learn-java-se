package my.kenny.test;

import java.util.ArrayList;
import java.util.Collection;
import java.util.HashSet;
import java.util.Iterator;
import java.util.List;
import java.util.Set;

import my.kenny.dao.EmployeeDao;
import my.kenny.entity.Dept;
import my.kenny.entity.Employee;

import org.hibernate.Query;
import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.hibernate.Transaction;
import org.hibernate.cfg.Configuration;
import org.junit.Test;


public class TestApp_second_cache {
  
	
	@Test
	public void testSecondCache(){
		EmployeeDao dao=new EmployeeDao();
		Session s1=dao.getSession();
		Transaction ts=s1.beginTransaction();
		Dept d=(Dept) s1.get(Dept.class, 2);
		System.out.println(d);
		//ts.commit();
		s1.close();
		//EmployeeDao dao=new EmployeeDao();
		Session s2=dao.getSession();
		Transaction ts1=s1.beginTransaction();
		  d=(Dept) s2.get(Dept.class, 2);
		System.out.println(d);
		//ts1.commit();
		s2.close();
		
	}
	 
	@Test
	public void testGetDept(){//在Dept.hbm.xml中将lazy设置为lazy="false"，否则报错
		List<Dept> list=new ArrayList<Dept>();
		 EmployeeDao ed=new EmployeeDao();
		  list=ed.getAllDept();
		 System.out.println(list);
	 }
	 
	@Test
	public void testUpdateDeptsameWorker(){
		Dept newdept=new Dept();
		EmployeeDao eld=new EmployeeDao();
		Session s=eld.getSession();
		int num=2;
	    Query q =s.createQuery("from Employee where dept_id="+num);
		List<Employee> list = q.list();
		Set<Employee> set=new HashSet<Employee>();
		for(Employee e:list){
			set.add(e);
		}
		Employee e1=eld.findbyIdEmp(num);
		newdept.setDeptName("财政部");
		newdept.setEmps(set);
		eld.updateDeptAll(num, newdept);
		
	}
	 
	@Test
	public void testDelete(){
		int num=7;
		EmployeeDao dao=new EmployeeDao();
		dao.deleteDept(num);//被外键引用的表必须要将inverse属性设置为false，也就是有控制器，才能删除，否则报错
	}
}
